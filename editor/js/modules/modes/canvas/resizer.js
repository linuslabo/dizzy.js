define(["sandbox"],function(b){function e(){c&&$(c).hide()}var f,h,d,c,i,k={start:function(){$(c).bind("mousedown.dizzy.resizer",function(a){j(a)})},stop:function(){$(c).unbind("mousedown.dizzy.resizer");$(document).unbind("mouseup.dizzy.resizer mouseleave.dizzy.resizer")}};b.subscribe("dizzy.ui.zebra.start",e);b.subscribe("dizzy.ui.toolbar.clicked",e);b.subscribe("dizzy.ui.zebra.stop",function(){var a=document.getElementsByClassName("selected")[0];a&&(a=a.children[0],a.localName=="rect"&&(g(a),c&&
$(c).show()))});b.subscribe("dizzy.presentation.transform",e);var j=function(a){a.stopPropagation();a.preventDefault();b.publish("dizzy.ui.resizer.start");var c=i;if(c){var e={x:a.pageX,y:a.pageY};$(document).bind("mousemove.dizzy.resizer",function(a){a.preventDefault();var b={x:a.pageX,y:a.pageY};parseFloat(b.x-e.x);parseFloat(b.y-e.y);var a=b.x,b=b.y,f=c.getScreenCTM();d.x=a;d.y=b;a=d.matrixTransform(f.inverse());b=Math.max(a.y-c.y.animVal.value,20);c.setAttribute("width",Math.max(a.x-c.x.animVal.value,
20));c.setAttribute("height",b);g(c)});$(document).bind("mouseup.dizzy.resizer mouseleave.dizzy.resizer",function(){$(document).unbind("mousemove.dizzy.resizer");b.publish("dizzy.ui.resizer.stop")})}};b.subscribe("dizzy.presentation.loaded",function(){h=document.getElementsByTagName("svg")[0];d=h.createSVGPoint()});b.subscribe("dizzy.presentation.group.selected",function(a){a=a.group.dom().children().first();a[0].localName=="rect"?(i=a[0],g(a[0]),c&&$(c).show()):e()});var g=function(a){var b=a.getScreenCTM();
d.x=a.x.animVal.value;d.y=a.y.animVal.value;d.x+=a.width.animVal.value;d.y+=a.height.animVal.value;a=d.matrixTransform(b);c.style.left=a.x-20+"px";c.style.top=a.y-20+"px"};return{init:function(){var a=$("#container");f=$('<div id="resizer"></div>');a.prepend(f);c=document.getElementById("resizer");e();b.publish("dizzy.modes.register",{name:"resizer",instance:k})},destroy:function(){}}});