define(["sandbox"],function(e){function f(a){a.stopPropagation();a.preventDefault();if(a.which!=1)return!1;$(b.svg.root()).bind("mousemove.dizzy.mode.ellipse",function(a){a.stopPropagation();a.preventDefault();var c=b.toViewboxCoordinates({x:a.pageX,y:a.pageY}),a=Math.abs(c.x-g),c=Math.abs(c.y-h);a>10&&d.attr("rx",a);c>10&&d.attr("ry",c)});var a=b.toViewboxCoordinates({x:a.pageX,y:a.pageY}),i=b.createGroup(),f=i.dom();d=$(b.svg.ellipse(a.x,a.y,10,10,{stroke:b.getStrokeColor(),fill:b.getFillColor(),
strokeWidth:3,fillOpacity:0}));g=a.x;h=a.y;f.append(d);e.publish("dizzy.canvas.group.created.ellipse",{group:i})}var b,d,g,h;e.subscribe("dizzy.presentation.loaded",function(a){b=a.canvas});var j={depends:["zoom","rightClick"],start:function(){b&&($(b.svg.root()).bind("mousedown.dizzy.mode.ellipse",function(a){return f(a)}),$(b.svg.root()).bind("mouseup.dizzy.mode.ellipse",function(){$(b.svg.root()).unbind("mousemove.dizzy.mode.ellipse")}),$(b.svg.root()).addClass("editing drawing"))},stop:function(){b&&
($(b.svg.root()).unbind("mousedown.dizzy.mode.ellipse"),$(b.svg.root()).unbind("mouseup.dizzy.mode.ellipse"),$(b.svg.root()).removeClass("editing drawing"))}};return{init:function(){e.publish("dizzy.modes.register",{name:"tool-circle",instance:j})},destroy:function(){}}});