define(["sandbox"],function(c){function d(a){a.stopPropagation();a.preventDefault();if(a.which!=1)return!1;$(b.svg.root()).bind("mousemove.dizzy.mode.line",function(a){a.stopPropagation();a.preventDefault();var a=b.toViewboxCoordinates({x:a.pageX,y:a.pageY}),c=Math.max(20,Math.abs(a.x-f)),d=Math.max(20,Math.abs(a.y-g));a.x-f<0&&e.attr({x:f-c});e.attr({width:c});a.y-g<0&&e.attr({y:g-d});e.attr({height:d})});var a=b.toViewboxCoordinates({x:a.pageX,y:a.pageY}),h=b.createGroup(),d=h.dom();b.getStrokeColor();
e=$(b.svg.rect(a.x,a.y,0,0,{width:20,height:20,stroke:b.getStrokeColor(),fill:b.getFillColor(),strokeWidth:5,fillOpacity:0}));f=a.x;g=a.y;d.append(e);c.publish("dizzy.canvas.group.created.rect",{group:h})}var b,e,f,g,i={depends:["zoom","rightClick"],start:function(){b&&($(b.svg.root()).bind("mousedown.dizzy.mode.line",function(a){return d(a)}),$(b.svg.root()).bind("mouseup.dizzy.mode.line",function(){$(b.svg.root()).unbind("mousemove.dizzy.mode.line")}),$(b.svg.root()).addClass("editing drawing"))},
stop:function(){b&&($(b.svg.root()).unbind("mousedown.dizzy.mode.line"),$(b.svg.root()).unbind("mouseup.dizzy.mode.line"),$(b.svg.root()).removeClass("editing drawing"))}};c.subscribe("dizzy.presentation.loaded",function(a){b=a.canvas});return{init:function(){c.publish("dizzy.modes.register",{name:"tool-rect",instance:i})},destroy:function(){}}});