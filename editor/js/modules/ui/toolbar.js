define(["sandbox"],function(d){var b;d.subscribe("dizzy.ui.toolbar.clicked",function(a){a.button!="menu-button"&&a.button!="tool-color"&&a.button!="present-toggle-button"&&(a=b.find("#"+a.button),a.siblings().removeClass("pressed"),a.addClass("pressed"))});return{init:function(){var a=this,f=$("#container");$.get("html/toolbar.html").success(function(a){f.prepend(a);b=f.find("#toolbar");d.publish("dizzy.ui.toolbar.loaded",{toolbar:b})}).error(function(){}).complete(function(){a.assignEventHandlers();
a.setColorPickers();setTimeout(function(){d.publish("dizzy.ui.toolbar.clicked.mode.tool-default",{button:"tool-default"})},1E3)})},setColorPickers:function(){function a(a,b){this.selector=new jscolor.color(a,{});this.selector.pickerOnfocus=!1;this.selector.pickerFace=2;this.selector.hash=!0;this.selector.fromString(b);this.opened=!1;this.open=function(){this.opened=!0;this.selector.showPicker()};this.close=function(){this.opened=!1;this.selector.hidePicker()}}var f=document.getElementById("tool-input-color-fill"),
c=new a(f,"#000000"),h=document.getElementById("tool-input-color-stroke"),e=new a(h,"#000000"),i=document.getElementById("tool-input-color-background"),g=new a(i,"#FFFFFF");b.find(".color").css({"font-size":"0"});d.subscribe("dizzy.presentation.transform",function(){c.close();e.close();g.close()});d.subscribe("dizzy.ui.toolbar.clicked",function(a){a.button!="tool-color"&&(c.close(),e.close(),g.close())});$(i).click(function(a){a.stopPropagation();g.opened?g.close():g.open()});$(f).click(function(){c.opened?
c.close():(e.close(),c.open())});$(h).click(function(){e.opened?e.close():(c.close(),e.open())})},assignEventHandlers:function(){b.css({MozUserSelect:"none"}).bind("selectstart select",function(){return!1}).mousedown(function(a){a.stoppropagation();return!1});b.children(":not(#tool-goto-input)").disableTextSelect();b.delegate(".toolbutton","click",function(){var a=$(this),b=a.attr("id");console.log("toolbar button "+b+" pressed.");var c="";a.hasClass("mode")&&(c+="mode.");d.publish("dizzy.ui.toolbar.clicked."+
c+b,{button:b})});b.delegate("#tool-input-color-fill","change",function(){d.publish("dizzy.ui.toolbar.color.fill.changed",{color:$(this).val()})});b.delegate("#tool-input-color-stroke","change",function(){d.publish("dizzy.ui.toolbar.color.stroke.changed",{color:$(this).val()})})},destroy:function(){$("#toolbar, #menu").remove()}}});